(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var Helper_1 = require('./Helper');
var CellController = (function () {
    function CellController(cell, x, y) {
        this.isAlive = false;
        this.cell = cell;
        this.x = x;
        this.y = y;
    }
    CellController.prototype.watchNeighbors = function () {
        var alives = 0;
        var deads = 0;
        var around = Helper_1.Helper.getNeighbors(this.x, this.y);
        for (var _i = 0, around_1 = around; _i < around_1.length; _i++) {
            var pos = around_1[_i];
            var neighbor = document.getElementById(pos[0] + "," + pos[1]);
            if (neighbor != undefined) {
                if (neighbor.classList.contains('alive'))
                    alives++;
                if (neighbor.classList.contains('dead'))
                    deads++;
            }
        }
        this.rules(alives, deads);
    };
    CellController.prototype.rules = function (alives, deads) {
        this.change = this.noChnage;
        if (this.isAlive && alives < 2)
            this.change = this.dies;
        if (this.isAlive && alives > 3)
            this.change = this.dies;
        // 2 or 3 alives, lives unchanged
        if (!this.isAlive && alives == 3)
            this.change = this.lives;
    };
    CellController.prototype.commitChnage = function () {
        this.change();
        Helper_1.Helper.printCell(this);
    };
    CellController.prototype.noChnage = function () { };
    CellController.prototype.lives = function () {
        this.cell.classList.remove('dead');
        this.cell.classList.add('alive');
        this.isAlive = true;
    };
    CellController.prototype.dies = function () {
        this.cell.classList.remove('alive');
        this.cell.classList.add('dead');
        this.isAlive = false;
    };
    return CellController;
}());
exports.CellController = CellController;

},{"./Helper":2}],2:[function(require,module,exports){
"use strict";
exports.Helper = {
    getNeighbors: function (x, y) {
        return [
            [x - 1, y - 1],
            [x - 1, y],
            [x - 1, y + 1],
            [x, y - 1],
            // [x, y],
            [x, y + 1],
            [x + 1, y - 1],
            [x + 1, y],
            [x + 1, y + 1],
        ];
    },
    printCell: function (cell) {
        var alives = document.getElementById('print-alives');
        if (cell.isAlive)
            alives.innerHTML += cell.x + ", " + cell.y + " <br>";
    }
};

},{}],3:[function(require,module,exports){
"use strict";
var CellController_1 = require('../cell/CellController');
var GridController = (function () {
    function GridController(id) {
        this.containerElem = document.getElementById(id);
        this.fillGridDone = new CustomEvent('fill-grid-done');
        this.size = 20; //make it more dynamic?
        this.grid = [];
        while (this.grid.push([]) < this.size)
            ;
    }
    GridController.prototype.getCell = function (x, y) {
        return this.grid[x][y];
    };
    GridController.prototype.fillGrid = function (callback) {
        this.containerElem.innerHTML = '';
        document.addEventListener('fill-grid-done', function (e) {
            callback();
        });
        for (var x in this.grid) {
            for (var y in this.grid) {
                this.createNewElement(Number(x), Number(y));
            }
        }
    };
    GridController.prototype.tick = function () {
        for (var x in this.grid) {
            for (var y in this.grid) {
                this.grid[x][y].watchNeighbors();
            }
        }
        for (var x in this.grid) {
            for (var y in this.grid) {
                this.grid[x][y].commitChnage();
            }
        }
    };
    GridController.prototype.createNewElement = function (x, y) {
        var _this = this;
        setTimeout(function () {
            var elem = document.createElement('div');
            elem.id = x + "," + y;
            elem.className = "gridPosition " + (y === 0 ? 'row' : '');
            _this.containerElem.appendChild(elem);
            _this.grid[x][y] = new CellController_1.CellController(elem, x, y);
            if (x == (_this.size - 1) && y == (_this.size - 1)) {
                document.dispatchEvent(_this.fillGridDone);
            }
        }, 50);
    };
    return GridController;
}());
exports.GridController = GridController;

},{"../cell/CellController":1}],4:[function(require,module,exports){
"use strict";
var GridController_1 = require('./grid/GridController');
window.onload = function () {
    var grid = new GridController_1.GridController('grid');
    document.getElementById('inputButton').onclick = function () {
        document.getElementById('grid').innerHTML = '';
        var elem = document.createElement('div');
        elem.id = 'grid' + Math.random();
        document.getElementById('grid').appendChild(elem);
        grid = new GridController_1.GridController(elem.id);
        grid.fillGrid(function () {
            var textArea = document.getElementById('manual-input');
            var lines = textArea.value.split("\n");
            for (var _i = 0, lines_1 = lines; _i < lines_1.length; _i++) {
                var line = lines_1[_i];
                var aux = line.split(',');
                if (aux.length === 2) {
                    grid.getCell(Number(aux[0]), Number(aux[1])).lives();
                }
            }
        });
    };
    var manualTick = new CustomEvent('manual-tick');
    document.getElementById('tickButton').onclick = function () {
        document.getElementById('print-alives').innerHTML = '';
        grid.tick();
    };
};

},{"./grid/GridController":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2VsbC9DZWxsQ29udHJvbGxlci50cyIsInNyYy9jZWxsL0hlbHBlci50cyIsInNyYy9ncmlkL0dyaWRDb250cm9sbGVyLnRzIiwic3JjL21haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQ0EsdUJBQXdCLFVBQVUsQ0FBQyxDQUFBO0FBRW5DO0lBUUksd0JBQVksSUFBaUIsRUFBRSxDQUFTLEVBQUUsQ0FBUztRQUMvQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNYLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsQ0FBQztJQUVELHVDQUFjLEdBQWQ7UUFDSSxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDZixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFFZCxJQUFJLE1BQU0sR0FBRyxlQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRWpELEdBQUcsQ0FBQyxDQUFZLFVBQU0sRUFBTixpQkFBTSxFQUFOLG9CQUFNLEVBQU4sSUFBTSxDQUFDO1lBQWxCLElBQUksR0FBRyxlQUFBO1lBQ1IsSUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQUksR0FBRyxDQUFDLENBQUMsQ0FBRyxDQUFDLENBQUM7WUFFOUQsRUFBRSxDQUFDLENBQUMsUUFBUSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNuRCxF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QUwsbUJBQUssRUFBTCxJQUFLLENBQUM7Z0JBQWxCLElBQUksSUFBSSxjQUFBO2dCQUNULElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzFCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3pELENBQUM7YUFDSjtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFBO0lBRUQsSUFBSSxVQUFVLEdBQUcsSUFBSSxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDaEQsUUFBUSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLEdBQUc7UUFDNUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBRXZELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNoQixDQUFDLENBQUE7QUFDTCxDQUFDLENBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG5pbXBvcnQgeyBIZWxwZXIgfSBmcm9tICAnLi9IZWxwZXInO1xuXG5leHBvcnQgY2xhc3MgQ2VsbENvbnRyb2xsZXIge1xuXG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgICBjZWxsOiBIVE1MRWxlbWVudDtcbiAgICBpc0FsaXZlOiBib29sZWFuO1xuICAgIGNoYW5nZTogRnVuY3Rpb247XG5cbiAgICBjb25zdHJ1Y3RvcihjZWxsOiBIVE1MRWxlbWVudCwgeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5pc0FsaXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2VsbCA9IGNlbGw7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgfVxuXG4gICAgd2F0Y2hOZWlnaGJvcnMoKSB7XG4gICAgICAgIGxldCBhbGl2ZXMgPSAwO1xuICAgICAgICBsZXQgZGVhZHMgPSAwO1xuXG4gICAgICAgIGxldCBhcm91bmQgPSBIZWxwZXIuZ2V0TmVpZ2hib3JzKHRoaXMueCwgdGhpcy55KTtcblxuICAgICAgICBmb3IgKGxldCBwb3Mgb2YgYXJvdW5kKSB7XG4gICAgICAgICAgICBsZXQgbmVpZ2hib3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwb3NbMF19LCR7cG9zWzFdfWApO1xuXG4gICAgICAgICAgICBpZiAobmVpZ2hib3IgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5laWdoYm9yLmNsYXNzTGlzdC5jb250YWlucygnYWxpdmUnKSkgYWxpdmVzKys7XG4gICAgICAgICAgICAgICAgaWYgKG5laWdoYm9yLmNsYXNzTGlzdC5jb250YWlucygnZGVhZCcpKSBkZWFkcysrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucnVsZXMoYWxpdmVzLCBkZWFkcyk7XG4gICAgfVxuXG4gICAgcnVsZXMoYWxpdmVzOiBudW1iZXIsIGRlYWRzOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2UgPSB0aGlzLm5vQ2huYWdlO1xuXG4gICAgICAgIGlmICh0aGlzLmlzQWxpdmUgJiYgYWxpdmVzIDwgMikgdGhpcy5jaGFuZ2UgPSB0aGlzLmRpZXM7XG4gICAgICAgIGlmICh0aGlzLmlzQWxpdmUgJiYgYWxpdmVzID4gMykgdGhpcy5jaGFuZ2UgPSB0aGlzLmRpZXM7XG4gICAgICAgIC8vIDIgb3IgMyBhbGl2ZXMsIGxpdmVzIHVuY2hhbmdlZFxuICAgICAgICBpZiAoIXRoaXMuaXNBbGl2ZSAmJiBhbGl2ZXMgPT0gMykgdGhpcy5jaGFuZ2UgPSB0aGlzLmxpdmVzO1xuICAgIH1cblxuICAgIGNvbW1pdENobmFnZSgpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2UoKTtcbiAgICAgICAgSGVscGVyLnByaW50Q2VsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBub0NobmFnZSgpIHsgfVxuXG4gICAgbGl2ZXMoKSB7XG4gICAgICAgIHRoaXMuY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdkZWFkJyk7XG4gICAgICAgIHRoaXMuY2VsbC5jbGFzc0xpc3QuYWRkKCdhbGl2ZScpO1xuICAgICAgICB0aGlzLmlzQWxpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIGRpZXMoKSB7XG4gICAgICAgIHRoaXMuY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdhbGl2ZScpO1xuICAgICAgICB0aGlzLmNlbGwuY2xhc3NMaXN0LmFkZCgnZGVhZCcpO1xuICAgICAgICB0aGlzLmlzQWxpdmUgPSBmYWxzZTtcbiAgICB9XG5cbn1cbiIsIlxuaW1wb3J0IHsgQ2VsbENvbnRyb2xsZXIgfSBmcm9tICcuL0NlbGxDb250cm9sbGVyJ1xuXG5leHBvcnQgbGV0IEhlbHBlciA9IHtcblxuICAgIGdldE5laWdoYm9yczogZnVuY3Rpb24oeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIFt4IC0gMSwgeSAtIDFdLFxuICAgICAgICAgICAgW3ggLSAxLCB5XSxcbiAgICAgICAgICAgIFt4IC0gMSwgeSArIDFdLFxuICAgICAgICAgICAgW3gsIHkgLSAxXSxcbiAgICAgICAgICAgIC8vIFt4LCB5XSxcbiAgICAgICAgICAgIFt4LCB5ICsgMV0sXG4gICAgICAgICAgICBbeCArIDEsIHkgLSAxXSxcbiAgICAgICAgICAgIFt4ICsgMSwgeV0sXG4gICAgICAgICAgICBbeCArIDEsIHkgKyAxXSxcbiAgICAgICAgXTtcbiAgICB9LFxuXG4gICAgcHJpbnRDZWxsOiBmdW5jdGlvbihjZWxsOiBDZWxsQ29udHJvbGxlcikge1xuICAgICAgbGV0IGFsaXZlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmludC1hbGl2ZXMnKTtcbiAgICAgIGlmKGNlbGwuaXNBbGl2ZSkgYWxpdmVzLmlubmVySFRNTCArPSBgJHtjZWxsLnh9LCAke2NlbGwueX0gPGJyPmA7XG4gICAgfVxuXG59XG4iLCJcbmltcG9ydCB7IENlbGxDb250cm9sbGVyIH0gZnJvbSAnLi4vY2VsbC9DZWxsQ29udHJvbGxlcic7XG5cbmV4cG9ydCBjbGFzcyBHcmlkQ29udHJvbGxlciB7XG5cbiAgICBjb250YWluZXJFbGVtOiBIVE1MRWxlbWVudDtcbiAgICBncmlkOiBDZWxsQ29udHJvbGxlcltdW107XG4gICAgc2l6ZTogbnVtYmVyO1xuXG4gICAgLy8gZXZlbnRzXG4gICAgZmlsbEdyaWREb25lOiBFdmVudDtcblxuICAgIGNlbGxzOiBBcnJheTxDZWxsQ29udHJvbGxlcj47XG5cbiAgICBjb25zdHJ1Y3RvcihpZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbiAgICAgICAgdGhpcy5maWxsR3JpZERvbmUgPSBuZXcgQ3VzdG9tRXZlbnQoJ2ZpbGwtZ3JpZC1kb25lJyk7XG4gICAgICAgIHRoaXMuc2l6ZSA9IDIwOyAvL21ha2UgaXQgbW9yZSBkeW5hbWljP1xuICAgICAgICB0aGlzLmdyaWQgPSBbXTtcbiAgICAgICAgd2hpbGUgKHRoaXMuZ3JpZC5wdXNoKFtdKSA8IHRoaXMuc2l6ZSk7XG4gICAgfVxuXG4gICAgZ2V0Q2VsbCh4OiBudW1iZXIsIHk6IG51bWJlcil7XG4gICAgICByZXR1cm4gdGhpcy5ncmlkW3hdW3ldO1xuICAgIH1cblxuICAgIGZpbGxHcmlkKGNhbGxiYWNrOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW0uaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZmlsbC1ncmlkLWRvbmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IHggaW4gdGhpcy5ncmlkKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB5IGluIHRoaXMuZ3JpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTmV3RWxlbWVudChOdW1iZXIoeCksIE51bWJlcih5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0aWNrKCl7XG4gICAgICBmb3IgKGxldCB4IGluIHRoaXMuZ3JpZCkge1xuICAgICAgICAgIGZvciAobGV0IHkgaW4gdGhpcy5ncmlkKSB7XG4gICAgICAgICAgICAgIHRoaXMuZ3JpZFt4XVt5XS53YXRjaE5laWdoYm9ycygpO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAobGV0IHggaW4gdGhpcy5ncmlkKSB7XG4gICAgICAgICAgZm9yIChsZXQgeSBpbiB0aGlzLmdyaWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5ncmlkW3hdW3ldLmNvbW1pdENobmFnZSgpO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVOZXdFbGVtZW50KHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGVsZW0uaWQgPSBgJHt4fSwke3l9YDtcbiAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lID0gYGdyaWRQb3NpdGlvbiAke3kgPT09IDAgPyAncm93JyA6ICcnfWA7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW0uYXBwZW5kQ2hpbGQoZWxlbSk7XG4gICAgICAgICAgICB0aGlzLmdyaWRbeF1beV0gPSBuZXcgQ2VsbENvbnRyb2xsZXIoZWxlbSwgeCwgeSk7XG5cbiAgICAgICAgICAgIGlmICh4ID09ICh0aGlzLnNpemUgLSAxKSAmJiB5ID09ICh0aGlzLnNpemUgLSAxKSkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQodGhpcy5maWxsR3JpZERvbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCA1MCk7XG4gICAgfVxufVxuIiwiXG5pbXBvcnQgeyBDZWxsQ29udHJvbGxlciB9IGZyb20gJy4vY2VsbC9DZWxsQ29udHJvbGxlcic7XG5pbXBvcnQgeyBHcmlkQ29udHJvbGxlciB9IGZyb20gJy4vZ3JpZC9HcmlkQ29udHJvbGxlcic7XG5cblxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcblxuICAgIGxldCBncmlkID0gbmV3IEdyaWRDb250cm9sbGVyKCdncmlkJyk7XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXRCdXR0b24nKS5vbmNsaWNrID0gKCkgPT4ge1xuXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZCcpLmlubmVySFRNTCA9ICcnO1xuXG4gICAgICBsZXQgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZWxlbS5pZCA9ICdncmlkJyArIE1hdGgucmFuZG9tKCk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZCcpLmFwcGVuZENoaWxkKGVsZW0pO1xuXG4gICAgICBncmlkID0gbmV3IEdyaWRDb250cm9sbGVyKGVsZW0uaWQpO1xuXG4gICAgICAgIGdyaWQuZmlsbEdyaWQoKCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRleHRBcmVhID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1pbnB1dCcpO1xuICAgICAgICAgICAgbGV0IGxpbmVzID0gdGV4dEFyZWEudmFsdWUuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgICAgICBmb3IgKGxldCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgbGV0IGF1eCA9IGxpbmUuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICBpZiAoYXV4Lmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICBncmlkLmdldENlbGwoTnVtYmVyKGF1eFswXSksIE51bWJlcihhdXhbMV0pKS5saXZlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IG1hbnVhbFRpY2sgPSBuZXcgQ3VzdG9tRXZlbnQoJ21hbnVhbC10aWNrJyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpY2tCdXR0b24nKS5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpbnQtYWxpdmVzJykuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgZ3JpZC50aWNrKCk7XG4gICAgfVxufVxuIl19
